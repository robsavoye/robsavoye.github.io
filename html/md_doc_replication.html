<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: Replication</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Replication </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Replication is the process of appyling a set changes to data. There are two types of replication files available for OpenStreetMap data, <a class="el" href="md_doc_changefile.html">changesets and changefiles</a> from their <a href="https://planet.openstreetmap.org/replication">planet</a> server. The level directory contains several subdirectories. All the subdirectory structures are the same.</p>
<p>Each of the directories contains a 3 digit name. A new directory is created whenever there are 1 million data files created. Each of these top level's subdirectories contains 1000 subdirectories, also named with a 3 digit value. Under those subdirectories, there are 1000 entries. The time interval between map updates is not consistent, so a <em>state.txt</em> file is used. This file contains the timestamp of the accompanying data file. The data file is compressed, and contains all the changed data.</p>
<p>For the change files, the directory structure looks like this: </p><pre class="fragment">minute/001/001/001/001.state.txt
minute/001/001/001/001.osc.gz.
minute/001/001/001/002.state.txt
minute/001/001/001/002.osc.gz.
etc...
</pre><p>Changesets are slightly different, as they contain no map data, just data on the changes made when uploaded. </p><pre class="fragment">changesets/001/001/001.osm.gz
changesets/001/001/001.state.txt
etc...
</pre><p>Since the data file uses the same 3 digit prefix as the state file, it's easy to get the right data for the timestamp. Because the size of the data in the changefiles varies, plus CPU load, network latency, etc... the time interval varies, so can't be calculated accurately. It is possible to get a rough idea. Underpass makes the best guess it can, and downloads a <em>state.txt</em> file that is close to the desired timestamp. Using that initial state.txt file it's possible to increment or decrement the prefix till the proper timestamp is found. Then the prefix is used to download the data file for processing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
