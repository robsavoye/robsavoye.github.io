<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: Database Schemas</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Database Schemas </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are several database schemas used for OpenStreetMap data. The primary one that operates the core servers uses <b>apidb</b>. There is a simplified version called <b>pgsnapshot</b>, which is more suited towards running ones own database. Both of these schemas are the only ones that can be updated with replication files. A replication file is the data of the actual change, and available with minutely, hourly, or daily updates.</p>
<p>Osmosis is commonly used for manipulating and importing data into these schemas. Although it has been unmaintained for several years. Itâ€™s written in Java, and as it uses temporary files on disk, an import can consume upwards of a terabyte.</p>
<p>Underpass can import a data file into the <em>pgsnapshot</em> schema without <em>osmosis</em>. It can use replication files to update the database.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
pgsnapshot</h1>
<p>The <em>pgsnapshot</em> schema is a more compact version of the main database. It contains geospatial information, and can be updated using replication files. It can also be easily queried to produce data extracts in OSM format. By default, it is not well suited to any data analysis that uses geospatial calculations since the nodes are stored separately from the ways. Underpass extends this schema by by adding a geometry column to the ways table.</p>
<p>schema.</p>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">actions  </td><td class="markdownTableBodyNone">The action to do for a change,ie.. Create, delete, or modify   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">locked  </td><td class="markdownTableBodyNone">Locked when updating the database   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nodes  </td><td class="markdownTableBodyNone">All the nodes   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">relation_members  </td><td class="markdownTableBodyNone">The memebers in a relation   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">relations  </td><td class="markdownTableBodyNone">A list of replations   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">replication_changes  </td><td class="markdownTableBodyNone">Counters on the changes in this replication file   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">schema_info  </td><td class="markdownTableBodyNone">Version number of this schema   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">spatial_ref_sys  </td><td class="markdownTableBodyNone">Geospatial data used by Postgis   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">sql_changes  </td><td class="markdownTableBodyNone">Used when applying a replication file   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">state  </td><td class="markdownTableBodyNone">The stat of the database update   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">users  </td><td class="markdownTableBodyNone">A list of user IDs and usernames   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">way_nodes  </td><td class="markdownTableBodyNone">A list of node references in a way   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ways  </td><td class="markdownTableBodyNone">A list of ways   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md23"></a>
apidb</h1>
<p>The <em>apidb</em> schema is the one that operates the core OpenStreetMap servers, and is usually access through a REST API.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">acls  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">active_storage_attachments  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">active_storage_blobs  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ar_internal_metadata  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">changeset_comments  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">changeset_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">changesets  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">changesets_subscribers  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">client_applications  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_node_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_nodes  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_relation_members  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_relation_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_relations  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_way_nodes  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">current_way_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">current_ways  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">delayed_jobs  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">diary_comments  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">diary_entries  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">diary_entry_subscriptions  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">friends  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gps_points  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gpx_file_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gpx_files  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">issue_comments  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">issues  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">languages  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">messages  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">node_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">nodes  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">note_comments  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">notes  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">oauth_nonces  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">oauth_tokens  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">redactions  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">relation_members  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">relation_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">relations  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">reports  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">schema_migrations  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">spatial_ref_sys  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">user_blocks  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">user_preferences  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">user_roles  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">user_tokens  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">users  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">way_nodes  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">way_tags  </td><td class="markdownTableBodyNone">tbd   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ways  </td><td class="markdownTableBodyNone">tbd   </td></tr>
</table>
<p>&#160; </p>
<h1><a class="anchor" id="autotoc_md24"></a>
osm2pgsql</h1>
<p>Osm2pgsql is the primary tool for importing OSM files. The <em>osm2pgsql</em> program can import a data file into postgres, but it doesnâ€™t support updating the data. As it contains geospatial data, itâ€™s a compact and easily queried schema. It lacks any knowledge of relations, which isnâ€™t usually a problem unless you want to do deeper analysis of the data.</p>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">planet_osm_line  </td><td class="markdownTableBodyNone">All of the ways that aren't a polygon   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">planet_osm_point  </td><td class="markdownTableBodyNone">All of the nodes   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">planet_osm_polygon  </td><td class="markdownTableBodyNone">All of the polygons   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">planet_osm_roads  </td><td class="markdownTableBodyNone">Unused currently   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">spatial_ref_sys  </td><td class="markdownTableBodyNone">Geospatial data for postgis   </td></tr>
</table>
<p>&#160; </p>
<h1><a class="anchor" id="autotoc_md25"></a>
ogr2ogr</h1>
<p>Ogr and GDAL are the basis for many GIS projects, but has minimal OSM data file support. It can read any of the file formats, and can import into a database. It does have one big improvement over the osm2pgsql format, namely better relation support. This schema can be used to calculate user statistics.</p>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">lines  </td><td class="markdownTableBodyNone">All of the single lines   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">multilinestrings  </td><td class="markdownTableBodyNone">All of the multiple lines   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">multipolygons  </td><td class="markdownTableBodyNone">All of the polygons   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">other_relations  </td><td class="markdownTableBodyNone">All of the tags   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">points  </td><td class="markdownTableBodyNone">All of the nodes   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">spatial_ref_sys  </td><td class="markdownTableBodyNone">Geospatial data for postgis   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
